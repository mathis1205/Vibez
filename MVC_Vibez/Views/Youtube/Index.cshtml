@model MVC_Vibez.Model.ProgramPage
@{
	ViewData["Title"] = "YoutubeApi";
}
@await Html.PartialAsync("_Navbar", Model.user)
<link rel="stylesheet" href="css/Youtube.css"/>
<body>
<div class="videos">
	<input class="input" type="text" id="searchQuery" placeholder="Search for videos">
	<button class="btn btnSend btn-primary" onclick="searchVideos()">Search</button>
</div>

<div class="videos">
	<div id="loading" style="display: none;">Loading...</div>
	<div id="videos"></div>
</div>

<script>

        async function searchVideos() {
            
            const query = document.getElementById('searchQuery').value;
            const videosContainer = document.getElementById('videos');
            const loadingIndicator = document.getElementById('loading');

            videosContainer.innerHTML = '';
            videosContainer.classList.add('border-active');
            loadingIndicator.style.display = 'block';

            try {
                const response = await fetch(`/YoutubeApi/SearchVideos?query=${query}`);
                const data = await response.json();
                displayVideos(data);
            } catch (error) {
                console.error('Error fetching YouTube API:', error);
                videosContainer.innerHTML = '<p>Failed to fetch videos. Please try again later.</p>';
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        function displayVideos(videos) {
            const videosContainer = document.getElementById('videos');
            videosContainer.innerHTML = ''; // Clear previous results

            if (videos.length === 0) {
                videosContainer.innerHTML = '<p>No videos found.</p>';
                return;
            }

            videos.forEach(video => {
                const videoId = video.videoId;
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.youtube.com/embed/${videoId}`;
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                videosContainer.appendChild(iframe);
            });
        }
    </script>
</body>